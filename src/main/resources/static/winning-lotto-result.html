<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¹ì²¨ ê²°ê³¼ ìƒì„¸</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="site-header">
    <nav class="navbar">
        <div class="nav-links">
            <a href="my-lotto.html" class="nav-link">MyLotto</a>
            <a href="random-lotto.html" class="nav-link">RandomLotto</a>
            <a href="purchased-lotto.html" class="nav-link">PurchasedLotto</a>
            <a href="winning-lotto.html" class="nav-link active">WinningResult</a>
        </div>
        <a href="index.html" class="nav-link">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1V9a1 1 0 011-1h2a1 1 0 011 1v10a1 1 0 001 1m-6 0h6" />
            </svg>
        </a>
    </nav>
</header>

<main class="main-content">
    <h1 class="content-title">ë‹¹ì²¨ ê²°ê³¼ ìƒì„¸</h1>
    <p id="date-info" class="content-subtitle">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>

    <div id="result-area" class="hidden">

        <div style="display: flex; justify-content: space-around; background: #f0f9ff; padding: 20px; border-radius: 10px; margin-bottom: 30px; border: 1px solid #bae6fd; max-width: 800px; margin-left: auto; margin-right: auto;">
            <div>
                <p style="font-size: 0.9rem; color: #555; margin-bottom: 5px;">ì´ êµ¬ë§¤ ê¸ˆì•¡</p>
                <p id="total-purchase" style="font-size: 1.2rem; font-weight: bold;">0ì›</p>
            </div>
            <div>
                <p style="font-size: 0.9rem; color: #555; margin-bottom: 5px;">ì´ ë‹¹ì²¨ ê¸ˆì•¡</p>
                <p id="total-win" style="font-size: 1.2rem; font-weight: bold; color: #003458;">0ì›</p>
            </div>
            <div>
                <p style="font-size: 0.9rem; color: #555; margin-bottom: 5px;">ìˆ˜ìµë¥  (ROI)</p>
                <p id="roi" style="font-size: 1.5rem; font-weight: bold; color: #d9534f;">0.0%</p>
            </div>
        </div>

        <div style="max-width: 800px; margin: 0 auto;">
            <h3 style="text-align: left; margin-bottom: 10px;">ğŸ“Š ë“±ìˆ˜ë³„ í•©ê³„</h3>
            <table class="stat-table">
                <thead>
                <tr>
                    <th>ë“±ìˆ˜</th>
                    <th>ë‹¹ì²¨ ê°œìˆ˜</th>
                    <th>ìƒê¸ˆ</th>
                </tr>
                </thead>
                <tbody>
                <tr><td>1ë“±</td><td id="count-FIRST">0ê°œ</td><td>20ì–µ</td></tr>
                <tr><td>2ë“±</td><td id="count-SECOND">0ê°œ</td><td>3,000ë§Œ</td></tr>
                <tr><td>3ë“±</td><td id="count-THIRD">0ê°œ</td><td>150ë§Œ</td></tr>
                <tr><td>4ë“±</td><td id="count-FOURTH">0ê°œ</td><td>5ë§Œ</td></tr>
                <tr><td>5ë“±</td><td id="count-FIFTH">0ê°œ</td><td>5ì²œ</td></tr>
                <tr><td>ê½</td><td id="count-NONE" style="color:#aaa;">0ê°œ</td><td>0ì›</td></tr>
                </tbody>
            </table>
        </div>

        <div style="max-width: 800px; margin: 40px auto 0 auto;">
            <h3 style="text-align: left; margin-bottom: 10px;">ì´ë²ˆ ì£¼ êµ¬ë§¤ ë¡œë˜ ìƒì„¸ ê²°ê³¼</h3>
            <table class="lotto-table">
                <thead>
                <tr>
                    <th>êµ¬ë§¤ì¼</th>
                    <th>ë¡œë˜ ë²ˆí˜¸</th>
                    <th>ê²°ê³¼</th>
                </tr>
                </thead>
                <tbody id="detail-list-body">
                </tbody>
            </table>
        </div>

        <div style="margin-top: 3rem;">
            <a href="winning-lotto.html" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>
</main>

<footer class="site-footer">
    <p>Copyright &copy; 2025 Im-minji</p>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ë‚ ì§œ ì¶”ì¶œ
        const params = new URLSearchParams(window.location.search);
        const date = params.get('date'); // ?date=2025-11-19

        if (!date) {
            alert('ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.');
            window.location.href = 'winning-lotto.html';
            return;
        }

        document.getElementById('date-info').innerText = `ê¸°ì¤€ì¼: ${date} ì£¼ì°¨ì˜ ê²°ê³¼ì…ë‹ˆë‹¤.`;

        try {
            // í†µê³„ ì¡°íšŒ
            const response = await fetch(`/im-minji/statistics?date=${date}`);

            if (!response.ok) {
                // í•´ë‹¹ ë‚ ì§œì— ë‹¹ì²¨ ë²ˆí˜¸ê°€ ì—†ê±°ë‚˜ êµ¬ë§¤ ë‚´ì—­ ì¡°íšŒ ì‹¤íŒ¨ ì‹œ
                throw new Error('ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }

            const data = await response.json();
            renderResults(data);

        } catch (error) {
            alert(error.message);
            document.getElementById('date-info').innerText = "ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨";
        }
    });

    function renderResults(data) {
        const formatter = new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' });

        // ì˜ì—­ í‘œì‹œ
        document.getElementById('result-area').classList.remove('hidden');

        // 1. ìš”ì•½ ì •ë³´ ë°”ì¸ë”©
        document.getElementById('total-purchase').innerText = formatter.format(data.totalPurchaseAmount);
        document.getElementById('total-win').innerText = formatter.format(data.totalWinningMoney);
        document.getElementById('roi').innerText = data.rateOfReturn.toFixed(1) + '%';

        // 2. ë“±ìˆ˜ë³„ ì¹´ìš´íŠ¸ ë°”ì¸ë”©
        const ranks = ['FIRST', 'SECOND', 'THIRD', 'FOURTH', 'FIFTH', 'NONE'];
        ranks.forEach(rank => {
            const el = document.getElementById(`count-${rank}`);
            if (el) el.innerText = (data.rankCounts[rank] || 0) + 'ê°œ';
        });

        // 3. ìƒì„¸ ë¡œë˜ ë¦¬ìŠ¤íŠ¸ ë°”ì¸ë”© (lottoResults ì‚¬ìš©)
        const tbody = document.getElementById('detail-list-body');
        tbody.innerHTML = '';

        if (!data.lottoResults || data.lottoResults.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3">í•´ë‹¹ ì£¼ì°¨ì— êµ¬ë§¤í•œ ë¡œë˜ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
        }

        data.lottoResults.forEach(ticket => {
            const tr = document.createElement('tr');

            let badge = `<span style="color: #aaa;">ê½</span>`;
            if (ticket.rank === 'FIRST') badge = `<span style="color: red; font-weight: bold;">1ë“±</span>`;
            else if (ticket.rank === 'SECOND') badge = `<span style="color: orange; font-weight: bold;">2ë“±</span>`;
            else if (ticket.rank === 'THIRD') badge = `<span style="color: gold; font-weight: bold;">3ë“±</span>`;
            else if (ticket.rank === 'FOURTH') badge = `<span style="color: blue; font-weight: bold;">4ë“±</span>`;
            else if (ticket.rank === 'FIFTH') badge = `<span style="color: green; font-weight: bold;">5ë“±</span>`;

            tr.innerHTML = `
                <td>${ticket.purchaseDate}</td>
                <td style="letter-spacing: 1px;">${ticket.numbers.join(', ')}</td>
                <td>${badge}</td>
            `;
            tbody.appendChild(tr);
        });
    }
</script>
</body>
</html>