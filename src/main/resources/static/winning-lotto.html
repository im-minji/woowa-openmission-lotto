<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œë˜ ì›¹ í”„ë¡œì íŠ¸ - ë‹¹ì²¨ ê²°ê³¼</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="site-header">
    <nav class="navbar">
        <div class="nav-links">
            <a href="my-lotto.html" class="nav-link">MyLotto</a>
            <a href="random-lotto.html" class="nav-link">RandomLotto</a>
            <a href="purchased-lotto.html" class="nav-link">PurchasedLotto</a>
            <a href="winning-lotto.html" class="nav-link" style="color: #003458; font-weight: bold;">WinningResult</a>
        </div>
        <a href="index.html" class="nav-link">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1V9a1 1 0 011-1h2a1 1 0 011 1v10a1 1 0 001 1m-6 0h6" />
            </svg>
        </a>
    </nav>
</header>

<main class="main-content">
    <h1 class="content-title">ë‹¹ì²¨ ê²°ê³¼ ë° í†µê³„</h1>
    <p class="content-subtitle">ì´ë²ˆ ì£¼ ë‹¹ì²¨ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  ë‚˜ì˜ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>

    <section>
        <h2 class="section-title">Step 1. ë‹¹ì²¨ ë²ˆí˜¸ ë“±ë¡</h2>

        <div class="save-form-box" style="text-align: center; max-width: 600px;">
            <div class="input-group">
                <label class="input-label" style="text-align: center;">ë‹¹ì²¨ ë²ˆí˜¸ 6ê°œ</label>
                <div class="lotto-inputs">
                    <input type="number" class="lotto-input win-num" min="1" max="45">
                    <input type="number" class="lotto-input win-num" min="1" max="45">
                    <input type="number" class="lotto-input win-num" min="1" max="45">
                    <input type="number" class="lotto-input win-num" min="1" max="45">
                    <input type="number" class="lotto-input win-num" min="1" max="45">
                    <input type="number" class="lotto-input win-num" min="1" max="45">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label" style="text-align: center; color: #b91c1c;">ë³´ë„ˆìŠ¤ ë²ˆí˜¸</label>
                <div class="lotto-inputs">
                    <input type="number" id="bonus-num" class="lotto-input bonus" min="1" max="45">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label" style="text-align: center;">ì¶”ì²¨ì¼ (ê¸°ì¤€ ë‚ ì§œ: í† ìš”ì¼)</label>
                <input type="date" id="draw-date" class="input-field date-input">
            </div>

            <button id="btn-register" class="btn btn-primary">ë‹¹ì²¨ ë²ˆí˜¸ ë“±ë¡í•˜ê¸°</button>
        </div>
    </section>

    <section>
        <h2 class="section-title">Step 2. ë‹¹ì²¨ ê²°ê³¼ í™•ì¸</h2>

        <div style="margin-bottom: 2rem;">
            <p class="content-description">í™•ì¸í•˜ê³  ì‹¶ì€ ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´, í•´ë‹¹ ì£¼ì°¨ì˜ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 1rem;">
                <input type="date" id="check-date" class="input-field date-input">
                <button id="btn-check" class="btn btn-secondary">ê²°ê³¼ í™•ì¸</button>
            </div>
        </div>

        <div id="result-area" class="hidden">
            <div class="result-box" style="text-align: center;">
                <span id="result-week-info" style="font-weight: bold; color: #003458;"></span>
            </div>

            <table class="stat-table">
                <thead>
                <tr>
                    <th>ë“±ìˆ˜</th>
                    <th>ì¼ì¹˜ ì¡°ê±´</th>
                    <th>ìƒê¸ˆ</th>
                    <th>ë‹¹ì²¨ ê°œìˆ˜</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>5ë“±</td>
                    <td>3ê°œ ì¼ì¹˜</td>
                    <td>5,000ì›</td>
                    <td id="count-FIFTH" style="font-weight: bold;">0ê°œ</td>
                </tr>
                <tr>
                    <td>4ë“±</td>
                    <td>4ê°œ ì¼ì¹˜</td>
                    <td>50,000ì›</td>
                    <td id="count-FOURTH" style="font-weight: bold;">0ê°œ</td>
                </tr>
                <tr>
                    <td>3ë“±</td>
                    <td>5ê°œ ì¼ì¹˜</td>
                    <td>1,500,000ì›</td>
                    <td id="count-THIRD" style="font-weight: bold;">0ê°œ</td>
                </tr>
                <tr>
                    <td>2ë“±</td>
                    <td>5ê°œ + ë³´ë„ˆìŠ¤</td>
                    <td>30,000,000ì›</td>
                    <td id="count-SECOND" style="font-weight: bold;">0ê°œ</td>
                </tr>
                <tr>
                    <td>1ë“±</td>
                    <td>6ê°œ ì¼ì¹˜</td>
                    <td>2,000,000,000ì›</td>
                    <td id="count-FIRST" style="font-weight: bold; color: #b91c1c;">0ê°œ</td>
                </tr>
                </tbody>
            </table>

            <div class="result-summary">
                <p class="content-subtitle">ì´ ìˆ˜ìµë¥  (ROI)</p>
                <span id="roi" class="roi-text">0.0%</span>
            </div>
        </div>
    </section>

</main>

<footer class="site-footer">
    <p>Copyright &copy; 2025 Im-minji</p>
</footer>

<script>
    // 1. ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
    console.log("ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");

    document.addEventListener('DOMContentLoaded', () => {
        console.log("DOM(HTML)ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.");

        // ë‚ ì§œ ì´ˆê¸°í™”
        const today = new Date().toISOString().split('T')[0];
        const drawDateElem = document.getElementById('draw-date');
        const checkDateElem = document.getElementById('check-date');

        if(drawDateElem && checkDateElem) {
            drawDateElem.value = today;
            checkDateElem.value = today;
        } else {
            console.error("ë‚ ì§œ ì…ë ¥ì°½(ID: draw-date ë˜ëŠ” check-date)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. HTML IDë¥¼ í™•ì¸í•˜ì„¸ìš”.");
        }

        // -------------------------------------------------------
        // ë²„íŠ¼ ìš”ì†Œ ì°¾ê¸° (ì—¬ê¸°ì„œ nullì´ ë‚˜ì˜¤ë©´ HTML ID ì˜¤íƒ€ì„)
        // -------------------------------------------------------
        const btnRegister = document.getElementById('btn-register');
        const btnCheck = document.getElementById('btn-check');

        console.log("ë²„íŠ¼ í™•ì¸:", { btnRegister, btnCheck });

        // -------------------------------------------------------
        // ê¸°ëŠ¥ 1: ë‹¹ì²¨ ë²ˆí˜¸ ë“±ë¡
        // -------------------------------------------------------
        if (btnRegister) {
            btnRegister.addEventListener('click', async () => {
                console.log("ğŸ–±ï¸ [ë“±ë¡í•˜ê¸°] ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤.");

                const winNumInputs = document.querySelectorAll('.win-num');
                const bonusInput = document.getElementById('bonus-num');
                const dateInput = document.getElementById('draw-date');

                // ê°’ ìˆ˜ì§‘
                const numbers = Array.from(winNumInputs).map(input => {
                    const val = parseInt(input.value);
                    return isNaN(val) ? null : val;
                });
                const bonusNum = parseInt(bonusInput.value);
                const drawDate = dateInput.value;

                console.log("ì…ë ¥ëœ ê°’:", { numbers, bonusNum, drawDate });

                // ê²€ì¦
                if (numbers.includes(null) || isNaN(bonusNum) || !drawDate) {
                    alert('ëª¨ë“  ë²ˆí˜¸ì™€ ë‚ ì§œë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    console.warn("ì…ë ¥ê°’ ëˆ„ë½ ë°œìƒ");
                    return;
                }

                try {
                    console.log("ì„œë²„ë¡œ POST ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤...");
                    const response = await fetch('/im-minji/winning-lotto', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ numbers, bonusNum, drawDate })
                    });

                    console.log("ì„œë²„ ì‘ë‹µ ìƒíƒœ:", response.status);

                    if (!response.ok) {
                        throw new Error(`ë“±ë¡ ì‹¤íŒ¨! ìƒíƒœ ì½”ë“œ: ${response.status}`);
                    }

                    alert('ë‹¹ì²¨ ë²ˆí˜¸ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    console.log("ë“±ë¡ ì„±ê³µ");

                } catch (error) {
                    console.error("ì—ëŸ¬ ë°œìƒ:", error);
                    alert('ì—ëŸ¬ ë°œìƒ: ' + error.message);
                }
            });
        } else {
            console.error("'btn-register' ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }

        // -------------------------------------------------------
        // ê¸°ëŠ¥ 2: í†µê³„ ì¡°íšŒ
        // -------------------------------------------------------
        if (btnCheck) {
            btnCheck.addEventListener('click', async () => {
                console.log("ğŸ–±ï¸ [ê²°ê³¼ í™•ì¸] ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤.");

                const dateInput = document.getElementById('check-date').value;
                if (!dateInput) {
                    alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                try {
                    console.log(`ì„œë²„ë¡œ GET ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤... ë‚ ì§œ: ${dateInput}`);
                    const response = await fetch(`/im-minji/statistics?date=${dateInput}`);

                    console.log("ì„œë²„ ì‘ë‹µ ìƒíƒœ:", response.status);

                    if (!response.ok) {
                        const errorText = await response.text(); // ì„œë²„ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
                        console.error("ì„œë²„ ì—ëŸ¬ ë©”ì‹œì§€:", errorText);
                        throw new Error('í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (í•´ë‹¹ ì£¼ì°¨ì— ë‹¹ì²¨ ë²ˆí˜¸ê°€ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤)');
                    }

                    const data = await response.json();
                    console.log("ë°›ì€ ë°ì´í„°:", data);
                    renderStatistics(data);

                } catch (error) {
                    console.error("ì—ëŸ¬ ë°œìƒ:", error);
                    alert(error.message);
                }
            });
        } else {
            console.error("'btn-check' ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }

        // í™”ë©´ ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function renderStatistics(data) {
            const resultArea = document.getElementById('result-area');
            if(resultArea) resultArea.classList.remove('hidden');

            // ë°ì´í„° ë°”ì¸ë”© ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
            setText('result-week-info', `ê¸°ì¤€ ì¶”ì²¨ì¼: ${data.drawDate} | ë³´ë„ˆìŠ¤: ${data.bonusNum}`);
            setText('count-FIFTH', (data.rankCounts.FIFTH || 0) + 'ê°œ');
            setText('count-FOURTH', (data.rankCounts.FOURTH || 0) + 'ê°œ');
            setText('count-THIRD', (data.rankCounts.THIRD || 0) + 'ê°œ');
            setText('count-SECOND', (data.rankCounts.SECOND || 0) + 'ê°œ');
            setText('count-FIRST', (data.rankCounts.FIRST || 0) + 'ê°œ');
            setText('roi', data.rateOfReturn.toFixed(1) + '%');
        }

        // í—¬í¼ í•¨ìˆ˜: IDê°€ ì—†ì–´ë„ ì—ëŸ¬ ì•ˆ ë‚˜ê²Œ ì²˜ë¦¬
        function setText(id, text) {
            const el = document.getElementById(id);
            if(el) el.innerText = text;
            else console.warn(`IDê°€ '${id}'ì¸ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ í…ìŠ¤íŠ¸ë¥¼ ë„£ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`);
        }
    });
</script>

</body>
</html>